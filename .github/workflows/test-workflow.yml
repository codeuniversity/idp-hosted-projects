name: "test-workflow"

on: 
  workflow_dispatch:

jobs:
  create-default-kube-services:
    permissions:
      id-token: write
      contents: read
    name: "Test"
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash
        working-directory: ./kubernetes-terraform-config
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - id: 'auth'
        name: 'Authenticate to Google Cloud'
        uses: 'google-github-actions/auth@v2'
        with:
          create_credentials_file: true
          workload_identity_provider: 'projects/1006240973223/locations/global/workloadIdentityPools/gha-create-gke-cluster/providers/github-actions'
          service_account: 'kube-deploy-student-projects@code-idp.iam.gserviceaccount.com'
      - name: Set up kubectl
        uses: azure/setup-kubectl@v3
        with:
          version: 'v1.28.0' 
      - name: Configure gcloud CLI
        run: |
          gcloud config set project code-idp
          gcloud container clusters get-credentials code-idp-gke --zone europe-west1
      - name: Deploy to GKE
        run: |
          kubectl get pods -n submissions-2024
